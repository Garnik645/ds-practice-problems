# üå≥ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å –≤—ã—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ AST

–í —ç—Ç–æ–π –∑–∞–¥–∞—á–µ –≤–∞–º –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä –∏ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å –¥–ª—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –≤ –≤–∏–¥–µ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π.

–°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"multiply(add(x, 5.5), negate(max(y, 10, 4)))"`) –≤ **–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä–µ–≤–æ (AST)**, –∞ –∑–∞—Ç–µ–º –≤—ã—á–∏—Å–ª—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±–æ–π–¥—è —ç—Ç–æ –¥–µ—Ä–µ–≤–æ.

## 1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∏–µ—Ä–∞—Ä—Ö–∏–∏ —É–∑–ª–æ–≤ (Node)

–î–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è AST –≤—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º.

* **–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å Node:**
–°–æ–∑–¥–∞–π—Ç–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å `Node`. –û–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É —á–∏—Å—Ç—É—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è —É–∑–ª–∞:
`virtual double evaluate(const std::vector<std::pair<std::string, double>>& context) const = 0;`
–¢–∞–∫–∂–µ –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä.

* **–ö–ª–∞—Å—Å—ã-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∏:**
–†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–∞–∫ –º–∏–Ω–∏–º—É–º —Ç—Ä–∏ –∫–ª–∞—Å—Å–∞-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞:

    * `NumberNode`: –•—Ä–∞–Ω–∏—Ç —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (`double`).
    * `VariableNode`: –•—Ä–∞–Ω–∏—Ç –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (`std::string`). 
    * `OperationNode`: –•—Ä–∞–Ω–∏—Ç –∏–º—è –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"add"`) –∏ —Å–ø–∏—Å–æ–∫ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã (`std::vector<Node*>`).

## 2. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

* **–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:** –í—Å–µ —á–∏—Å–ª–æ–≤—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –¥–æ–ª–∂–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –∫–∞–∫ `double`.

* **–û–ø–µ—Ä–∞—Ü–∏–∏:**

    * **–ë–∏–Ω–∞—Ä–Ω—ã–µ:** `add(a, b)`, `subtract(a, b)`, `multiply(a, b)`, `divide(a, b)`
    * **–£–Ω–∞—Ä–Ω—ã–µ:** `negate(a)` (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞–∫–∞, `-a`)
    * **–í–∞—Ä–∏–∞—Ç–∏–≤–Ω—ã–µ:** `max(a, b, ...)` –∏ `min(a, b, ...)` (–ø—Ä–∏–Ω–∏–º–∞—é—Ç –æ–¥–∏–Ω –∏–ª–∏ –±–æ–ª–µ–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤)

## 3. –§—É–Ω–∫—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ (parse)

–†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `Node* parse(std::string expression)`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∫–æ—Ä–Ω–µ–≤–æ–π —É–∑–µ–ª –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ AST.

**–ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
–î–ª—è —Ä–∞–∑–±–æ—Ä–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Å—Ç–µ–∫–æ–≤—ã–π (stack-based) –ø–æ–¥—Ö–æ–¥**. –ü—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `add(`) –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å `OperationNode` –∏ –ø–æ–º–µ—Å—Ç–∏—Ç—å –µ–≥–æ –≤ —Å—Ç–µ–∫. –ö–æ–≥–¥–∞ –≤—ã –ø–∞—Ä—Å–∏—Ç–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã (—á–∏—Å–ª–∞, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤), –≤—ã –¥–æ–±–∞–≤–ª—è–µ—Ç–µ –∏—Ö –∫–∞–∫ –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã –∫ —É–∑–ª—É –æ–ø–µ—Ä–∞—Ü–∏–∏, –Ω–∞—Ö–æ–¥—è—â–µ–º—É—Å—è –Ω–∞ –≤–µ—Ä—à–∏–Ω–µ —Å—Ç–µ–∫–∞. –ü—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ –∑–∞–∫—Ä—ã–≤–∞—é—â–µ–π —Å–∫–æ–±–∫–∏ `)` –æ–ø–µ—Ä–∞—Ü–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π, —É–∑–µ–ª —Å–Ω–∏–º–∞–µ—Ç—Å—è —Å–æ —Å—Ç–µ–∫–∞ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –¥–æ—á–µ—Ä–Ω–∏–π –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å).

## 4. –§—É–Ω–∫—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è (evaluate)

–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø—É—Ç–µ–º –≤—ã–∑–æ–≤–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ `evaluate()` —É –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —É–∑–ª–∞.

* `NumberNode::evaluate(...)`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `double`.
* `VariableNode::evaluate(...)`: –ò—â–µ—Ç –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ `context` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ—ë –∑–Ω–∞—á–µ–Ω–∏–µ.
* `OperationNode::evaluate(...)`: –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç `evaluate()` –¥–ª—è –≤—Å–µ—Ö –¥–æ—á–µ—Ä–Ω–∏—Ö —É–∑–ª–æ–≤, –∞ –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–≤–æ—é –æ–ø–µ—Ä–∞—Ü–∏—é (`add`, `max` –∏ —Ç.–¥.) –Ω–∞–¥ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.

## 5. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

* –í—ã—Ä–∞–∂–µ–Ω–∏—è –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `x`, `y`).
* –§—É–Ω–∫—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å "–∫–æ–Ω—Ç–µ–∫—Å—Ç" (`std::vector<std::pair<std::string, double>>`), —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –∏–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è–º.

## 6. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏, –≤—ã–±—Ä–∞—Å—ã–≤–∞—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:
* **–û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞:** `std::invalid_argument` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥) –ø—Ä–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–∫–æ–±–∫–∏, –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –Ω–µ–≤–µ—Ä–Ω–æ–µ —á–∏—Å–ª–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ —Ç.–¥.).
* **–û—à–∏–±–∫–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è:** `std::runtime_error` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥) –ø—Ä–∏ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö (–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å, –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ).

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```cpp
// –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
std::vector<std::pair<std::string, double>> context = {
    {"x", 2.5},
    {"y", 12.0}
};

std::string expression = "multiply(add(x, 5.5), negate(max(y, 10, 4)))";

try {
    // 1. –ü–∞—Ä—Å–∏–Ω–≥
    Node* ast = parse(expression);
    
    // 2. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ
    double result = ast->evaluate(context);
    
    // –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: -96.0
    // multiply(add(2.5, 5.5), negate(max(12.0, 10, 4)))
    // -> multiply(8.0, negate(12.0))
    // -> multiply(8.0, -12.0)
    // -> -96.0
    std::cout << "Result: " << result << std::endl;
    
    // 3. –û—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏ (–Ω–µ –∑–∞–±—É–¥—å—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å)
    delete ast; // –î–æ–ª–∂–Ω–æ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã

} catch (const std::exception& e) {
    std::cerr << "Error: " << e.what() << std::endl;
}
```
